 <!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reconhecimento de Cor - Compatibilidade</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            font-size: 2rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .upload-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 600px) {
            .upload-section {
                grid-template-columns: 1fr;
            }
        }

        .image-box {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .image-box h3 {
            margin-bottom: 15px;
            color: #555;
            font-size: 1.1rem;
        }

        .drop-zone {
            border: 3px dashed #ccc;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .drop-zone:hover, .drop-zone.dragover {
            border-color: #667eea;
            background: #e8eaf6;
            transform: translateY(-2px);
        }

        .drop-zone.has-image {
            border-style: solid;
            border-color: #667eea;
            padding: 20px;
        }

        .preview-img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            display: none;
        }

        .preview-img.active {
            display: block;
            margin: 0 auto 10px;
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 10px;
            opacity: 0.5;
        }

        .color-palette {
            margin-top: 15px;
            display: none;
        }

        .color-palette.active {
            display: block;
        }

        .palette-bar {
            height: 40px;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .color-segment {
            height: 100%;
            transition: transform 0.2s;
            position: relative;
        }

        .color-segment:hover {
            transform: scaleY(1.2);
            z-index: 10;
        }

        .analyze-btn {
            display: block;
            width: 100%;
            max-width: 400px;
            margin: 0 auto 30px;
            padding: 16px 32px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
            transition: all 0.3s;
        }

        .analyze-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 87, 108, 0.6);
        }

        .analyze-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background: #ccc;
        }

        .result-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            display: none;
            text-align: center;
        }

        .result-section.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .score-circle {
            width: 200px;
            height: 200px;
            margin: 0 auto 30px;
            position: relative;
        }

        .score-circle svg {
            transform: rotate(-90deg);
            width: 100%;
            height: 100%;
        }

        .score-bg {
            fill: none;
            stroke: #e0e0e0;
            stroke-width: 10;
        }

        .score-progress {
            fill: none;
            stroke-width: 10;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s ease;
        }

        .score-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3.5rem;
            font-weight: bold;
            color: #333;
        }

        .score-label {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 20px;
        }

        .compatibility-badge {
            display: inline-block;
            padding: 10px 25px;
            border-radius: 25px;
            font-weight: bold;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }

        .compatibility-text {
            color: #555;
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
        }

        .color-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
            text-align: left;
        }

        @media (max-width: 600px) {
            .color-details {
                grid-template-columns: 1fr;
            }
        }

        .color-list {
            background: #f5f5f5;
            border-radius: 12px;
            padding: 15px;
        }

        .color-list h4 {
            margin-bottom: 10px;
            color: #555;
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .color-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            margin-bottom: 5px;
            background: white;
            border-radius: 8px;
        }

        .color-dot {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .color-info {
            flex: 1;
        }

        .color-hex {
            font-family: monospace;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .color-percent {
            color: #888;
            font-size: 0.85rem;
        }

        .remove-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-top: 10px;
        }

        .remove-btn:hover {
            background: #ff3344;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ¨ AnÃ¡lise de Compatibilidade de Cores</h1>
        
        <div class="upload-section">
            <div class="image-box">
                <h3>Imagem 1</h3>
                <div class="drop-zone" id="dropZone1" onclick="document.getElementById('file1').click()">
                    <input type="file" id="file1" class="hidden" accept="image/*" onchange="handleFileSelect(event, 1)">
                    <div class="upload-icon">ðŸ“·</div>
                    <p>Clique ou arraste uma imagem</p>
                    <img id="preview1" class="preview-img" alt="Preview">
                    <button class="remove-btn hidden" id="remove1" onclick="event.stopPropagation(); clearImage(1)">Remover</button>
                </div>
                <div class="color-palette" id="palette1">
                    <div class="palette-bar" id="bar1"></div>
                </div>
            </div>

            <div class="image-box">
                <h3>Imagem 2</h3>
                <div class="drop-zone" id="dropZone2" onclick="document.getElementById('file2').click()">
                    <input type="file" id="file2" class="hidden" accept="image/*" onchange="handleFileSelect(event, 2)">
                    <div class="upload-icon">ðŸ“·</div>
                    <p>Clique ou arraste uma imagem</p>
                    <img id="preview2" class="preview-img" alt="Preview">
                    <button class="remove-btn hidden" id="remove2" onclick="event.stopPropagation(); clearImage(2)">Remover</button>
                </div>
                <div class="color-palette" id="palette2">
                    <div class="palette-bar" id="bar2"></div>
                </div>
            </div>
        </div>

        <button class="analyze-btn" id="analyzeBtn" onclick="analyzeImages()" disabled>Analisar Compatibilidade</button>

        <div class="result-section" id="resultSection">
            <div class="score-circle">
                <svg viewBox="0 0 200 200">
                    <circle class="score-bg" cx="100" cy="100" r="90"></circle>
                    <circle class="score-progress" id="progressCircle" cx="100" cy="100" r="90" 
                            stroke-dasharray="565.48" stroke-dashoffset="565.48"></circle>
                </svg>
                <div class="score-text" id="scoreText">0%</div>
            </div>
            
            <div class="score-label">Compatibilidade de Cores</div>
            
            <div class="compatibility-badge" id="badge"></div>
            
            <p class="compatibility-text" id="analysisText"></p>

            <div class="color-details">
                <div class="color-list" id="list1">
                    <h4>Cores Dominantes - Imagem 1</h4>
                </div>
                <div class="color-list" id="list2">
                    <h4>Cores Dominantes - Imagem 2</h4>
                </div>
            </div>
        </div>
    </div>

    <canvas id="canvas" class="hidden"></canvas>

    <script>
        // VariÃ¡veis globais
        let palettes = { 1: [], 2: [] };
        let imagesLoaded = { 1: false, 2: false };

        // Configurar drag and drop
        function setupDragDrop() {
            [1, 2].forEach(num => {
                const zone = document.getElementById('dropZone' + num);
                
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    zone.classList.add('dragover');
                });
                
                zone.addEventListener('dragleave', () => {
                    zone.classList.remove('dragover');
                });
                
                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        processFile(files[0], num);
                    }
                });
            });
        }

        // Handler para seleÃ§Ã£o de arquivo
        function handleFileSelect(event, num) {
            const file = event.target.files[0];
            if (file) {
                processFile(file, num);
            }
        }

        // Processar arquivo
        function processFile(file, num) {
            if (!file.type.startsWith('image/')) {
                alert('Por favor, selecione uma imagem vÃ¡lida.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    displayImage(img, num);
                    extractColors(img, num);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // Exibir imagem
        function displayImage(img, num) {
            const preview = document.getElementById('preview' + num);
            const dropZone = document.getElementById('dropZone' + num);
            const removeBtn = document.getElementById('remove' + num);
            
            preview.src = img.src;
            preview.classList.add('active');
            dropZone.classList.add('has-image');
            removeBtn.classList.remove('hidden');
            
            // Esconder Ã­cone e texto
            dropZone.querySelector('.upload-icon').style.display = 'none';
            dropZone.querySelector('p').style.display = 'none';
            
            imagesLoaded[num] = true;
            checkAnalyzeButton();
        }

        // Limpar imagem
        function clearImage(num) {
            const preview = document.getElementById('preview' + num);
            const dropZone = document.getElementById('dropZone' + num);
            const removeBtn = document.getElementById('remove' + num);
            const fileInput = document.getElementById('file' + num);
            const palette = document.getElementById('palette' + num);
            
            preview.src = '';
            preview.classList.remove('active');
            dropZone.classList.remove('has-image');
            removeBtn.classList.add('hidden');
            palette.classList.remove('active');
            
            // Mostrar Ã­cone e texto
            dropZone.querySelector('.upload-icon').style.display = 'block';
            dropZone.querySelector('p').style.display = 'block';
            
            fileInput.value = '';
            palettes[num] = [];
            imagesLoaded[num] = false;
            
            document.getElementById('resultSection').classList.remove('active');
            checkAnalyzeButton();
        }

        // Extrair cores
        function extractColors(img, num) {
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            
            // Redimensionar para anÃ¡lise
            const scale = Math.min(1, 200 / Math.max(img.width, img.height));
            canvas.width = img.width * scale;
            canvas.height = img.height * scale;
            
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const pixels = imageData.data;
            
            // QuantizaÃ§Ã£o de cores
            const colorMap = {};
            const step = 4 * 4; // Amostrar a cada 4 pixels
            
            for (let i = 0; i < pixels.length; i += step) {
                const r = Math.round(pixels[i] / 32) * 32;
                const g = Math.round(pixels[i + 1] / 32) * 32;
                const b = Math.round(pixels[i + 2] / 32) * 32;
                
                const key = r + ',' + g + ',' + b;
                colorMap[key] = (colorMap[key] || 0) + 1;
            }
            
            // Ordenar por frequÃªncia
            const sortedColors = Object.entries(colorMap)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5)
                .map(([color, count]) => {
                    const [r, g, b] = color.split(',').map(Number);
                    return {
                        r, g, b,
                        hex: rgbToHex(r, g, b),
                        count
                    };
                });
            
            palettes[num] = sortedColors;
            displayPalette(sortedColors, num);
        }

        // Converter RGB para Hex
        function rgbToHex(r, g, b) {
            return '#' + [r, g, b].map(x => {
                const hex = x.toString(16);
                return hex.length === 1 ? '0' + hex : hex;
            }).join('');
        }

        // Exibir paleta
        function displayPalette(colors, num) {
            const bar = document.getElementById('bar' + num);
            const palette = document.getElementById('palette' + num);
            const list = document.getElementById('list' + num);
            
            bar.innerHTML = '';
            list.innerHTML = '<h4>Cores Dominantes - Imagem ' + num + '</h4>';
            
            const total = colors.reduce((sum, c) => sum + c.count, 0);
            
            colors.forEach((color, index) => {
                const percent = (color.count / total * 100).toFixed(1);
                
                // Barra de cores
                const segment = document.createElement('div');
                segment.className = 'color-segment';
                segment.style.width = Math.max(percent, 10) + '%';
                segment.style.backgroundColor = color.hex;
                segment.title = color.hex + ' - ' + percent + '%';
                bar.appendChild(segment);
                
                // Lista detalhada
                const item = document.createElement('div');
                item.className = 'color-item';
                item.innerHTML = `
                    <div class="color-dot" style="background-color: ${color.hex}"></div>
                    <div class="color-info">
                        <div class="color-hex">${color.hex.toUpperCase()}</div>
                        <div class="color-percent">${percent}%</div>
                    </div>
                `;
                list.appendChild(item);
            });
            
            palette.classList.add('active');
        }

        // Verificar botÃ£o de anÃ¡lise
        function checkAnalyzeButton() {
            const btn = document.getElementById('analyzeBtn');
            btn.disabled = !(imagesLoaded[1] && imagesLoaded[2]);
        }

        // Analisar imagens
        function analyzeImages() {
            if (!imagesLoaded[1] || !imagesLoaded[2]) return;
            
            const btn = document.getElementById('analyzeBtn');
            btn.textContent = 'Analisando...';
            
            setTimeout(() => {
                const result = calculateCompatibility();
                showResults(result);
                btn.textContent = 'Analisar Compatibilidade';
            }, 500);
        }

        // Calcular compatibilidade
        function calculateCompatibility() {
            let totalScore = 0;
            let comparisons = 0;
            
            // Comparar cada cor da paleta 1 com cada cor da paleta 2
            for (let c1 of palettes[1]) {
                for (let c2 of palettes[2]) {
                    const score = compareColors(c1, c2);
                    totalScore += score;
                    comparisons++;
                }
            }
            
            const avgScore = totalScore / comparisons;
            const finalScore = Math.round(Math.min(100, Math.max(0, avgScore)));
            
            return {
                score: finalScore,
                description: getDescription(finalScore)
            };
        }

        // Comparar duas cores
        function compareColors(c1, c2) {
            // Converter para HSL
            const hsl1 = rgbToHsl(c1.r, c1.g, c1.b);
            const hsl2 = rgbToHsl(c2.r, c2.g, c2.b);
            
            // DiferenÃ§a de matiz
            let hueDiff = Math.abs(hsl1.h - hsl2.h);
            if (hueDiff > 180) hueDiff = 360 - hueDiff;
            
            // PontuaÃ§Ã£o baseada na diferenÃ§a de matiz
            let score = 100 - (hueDiff / 1.8);
            
            // BÃ´nus para cores complementares (opostas)
            if (hueDiff >= 150 && hueDiff <= 210) {
                score += 20;
            }
            // BÃ´nus para cores anÃ¡logas (prÃ³ximas)
            else if (hueDiff <= 30) {
                score += 15;
            }
            
            // Similaridade de saturaÃ§Ã£o e luminosidade
            const satDiff = Math.abs(hsl1.s - hsl2.s);
            const lightDiff = Math.abs(hsl1.l - hsl2.l);
            
            score = (score * 0.5) + ((100 - satDiff) * 0.25) + ((100 - lightDiff) * 0.25);
            
            return Math.min(100, score);
        }

        // Converter RGB para HSL
        function rgbToHsl(r, g, b) {
            r /= 255;
            g /= 255;
            b /= 255;
            
            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;
            
            if (max === min) {
                h = s = 0;
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                
                switch (max) {
                    case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
                    case g: h = ((b - r) / d + 2) / 6; break;
                    case b: h = ((r - g) / d + 4) / 6; break;
                }
            }
            
            return {
                h: h * 360,
                s: s * 100,
                l: l * 100
            };
        }

        // Obter descriÃ§Ã£o
        function getDescription(score) {
            if (score >= 85) return {
                level: 'Excelente',
                color: '#10b981',
                text: 'As imagens possuem compatibilidade excepcional! As paletas se complementam perfeitamente, criando uma harmonia visual sofisticada. Ideais para uso conjunto em projetos profissionais.'
            };
            if (score >= 70) return {
                level: 'Muito Bom',
                color: '#3b82f6',
                text: 'Compatibilidade muito boa entre as imagens. Existe uma relaÃ§Ã£o cromÃ¡tica forte que permite combinaÃ§Ãµes elegantes e profissionais.'
            };
            if (score >= 55) return {
                level: 'Bom',
                color: '#f59e0b',
                text: 'As imagens possuem compatibilidade razoÃ¡vel. HÃ¡ elementos que funcionam bem juntos, embora alguns ajustes finos possam melhorar o resultado.'
            };
            if (score >= 40) return {
                level: 'Regular',
                color: '#f97316',
                text: 'Compatibilidade moderada. As paletas tÃªm diferenÃ§as significativas que podem exigir cuidado na combinaÃ§Ã£o.'
            };
            return {
                level: 'Baixa',
                color: '#ef4444',
                text: 'As imagens possuem baixa compatibilidade cromÃ¡tica. As paletas competem entre si. Recomenda-se ajuste de cores antes de combinÃ¡-las.'
            };
        }

        // Mostrar resultados
        function showResults(result) {
            const section = document.getElementById('resultSection');
            const circle = document.getElementById('progressCircle');
            const text = document.getElementById('scoreText');
            const badge = document.getElementById('badge');
            const analysis = document.getElementById('analysisText');
            
            section.classList.add('active');
            
            // AnimaÃ§Ã£o do cÃ­rculo
            const circumference = 2 * Math.PI * 90;
            const offset = circumference - (result.score / 100) * circumference;
            
            circle.style.strokeDashoffset = offset;
            circle.style.stroke = result.description.color;
            
            // AnimaÃ§Ã£o do nÃºmero
            let current = 0;
            const increment = result.score / 20;
            const timer = setInterval(() => {
                current += increment;
                if (current >= result.score) {
                    current = result.score;
                    clearInterval(timer);
                }
                text.textContent = Math.round(current) + '%';
            }, 50);
            
            // Badge e texto
            badge.textContent = result.description.level;
            badge.style.backgroundColor = result.description.color + '20';
            badge.style.color = result.description.color;
            analysis.textContent = result.description.text;
            
            // Scroll suave
            section.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Inicializar
        window.onload = setupDragDrop;
    </script>
</body>
</html>
